<!DOCTYPE html>
<html lang="en">
<head>
	<title>Aviya Magnus - Signup</title>
	<meta charset="UTF-8">
	<meta name="description" content="Aviya Magnus Education Template">
	<meta name="keywords" content="Aviya Magnus, education, creative, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="img/favicon.ico" rel="shortcut icon"/>
	<link href="https://fonts.googleapis.com/css?family=Raleway:400,500,600,700,800" rel="stylesheet">
	<link rel="stylesheet" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" href="css/font-awesome.min.css"/>
	<link rel="stylesheet" href="css/owl.carousel.css"/>
	<link rel="stylesheet" href="css/style.css"/>
	<style>
		.error-message { color: red; display: none; font-size: 14px; margin-top: 5px; }
	</style>
</head>
<body>
	<header class="header-section">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-md-3">
					<div class="site-logo">
						<img src="img/logo.png" alt="">
					</div>
					<div class="nav-switch"><i class="fa fa-bars"></i></div>
				</div>
				<div class="col-lg-9 col-md-9">
					<nav class="main-menu"><ul></ul></nav>
				</div>
			</div>
		</div>
	</header>

	<section class="hero-section set-bg" data-setbg="img/bg.jpg">
		<div class="container">
			<h2>Join Aviya Magnus</h2>
			<p>Start your learning journey â€” Create your free account today.</p>

			<form id="signupForm" class="signup-form" novalidate>
				<select name="role" id="role" required>
					<option value="">Select Role</option>
					<option value="student">Student</option>
					<option value="parent">Parent</option>
					<option value="tutor">Tutor</option>
				</select>

				<div class="row">
					<div class="col-md-6">
						<input type="text" id="firstName" name="firstName" placeholder="First Name" required>
					</div>
					<div class="col-md-6">
						<input type="text" id="lastName" name="lastName" placeholder="Last Name" required>
					</div>
				</div>

				<input type="email" id="email" name="email" placeholder="Enter your email" required>

				<div class="row">
					<div class="col-md-4">
						<select id="countryCode" name="countryCode" required>
							<option value="">Code</option>
							<option value="+91">ðŸ‡®ðŸ‡³ +91</option>
							<option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
							<option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
							<option value="+61">ðŸ‡¦ðŸ‡º +61</option>
							<option value="+971">ðŸ‡¦ðŸ‡ª +971</option>
						</select>
					</div>
					<div class="col-md-8">
						<input type="tel" id="mobile" name="mobile" placeholder="Mobile Number" pattern="[0-9]{10,15}" required>
						<p class="error-message" id="mobileError">Please enter a valid mobile number.</p>
					</div>
				</div>

				<input type="password" id="password" name="password" placeholder="Password" required>
				<input type="password" id="confirmPassword" name="confirmPassword" placeholder="Re-enter Password" required>
				<p class="error-message" id="passwordError">Passwords do not match!</p>

<!-- Captcha display and input -->
<div class="captcha-box" style="margin-bottom: 15px;">
    <div id="captchaText" 
         style="font-weight: bold; font-size: 20px; letter-spacing: 5px; background: #eee; padding: 10px; width: fit-content; user-select: none;">
    </div>
    <input type="text" id="captchaInput" placeholder="Enter Captcha" required 
           style="margin-top: 10px; padding: 8px; width: 100%; box-sizing: border-box;">
    <p id="captchaError" style="color:red; display:none; margin-top:5px;">Captcha mismatch! Please try again.</p>
    <button type="button" onclick="generateCaptcha()" 
            style="margin-top:10px; padding:5px 10px;">Refresh Captcha</button>
</div>

	</section>

	<footer class="footer-section spad pb-0">
		<div class="footer-top">
			<div class="footer-warp">
				<div class="row">
					<!-- Footer content here -->
				</div>
			</div>
		</div>
	</footer>

	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/main.js"></script>
	<script>
		// Generate Captcha
		function generateCaptcha() {
			const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
			let captcha = '';
			for (let i = 0; i < 5; i++) {
				captcha += chars.charAt(Math.floor(Math.random() * chars.length));
			}
			document.getElementById('captchaText').textContent = captcha;
		}

	fetch('http://localhost:5000/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    role: document.getElementById('role').value,
    firstName: document.getElementById('firstName').value,
    lastName: document.getElementById('lastName').value,
    email: document.getElementById('email').value,
    countryCode: document.getElementById('countryCode').value,
    mobile: document.getElementById('mobile').value,
    password: document.getElementById('password').value
  })
				// Validate and submit form
		function submitSignup() {
			const form = document.getElementById('signupForm');
			const role = document.getElementById('role').value.trim();
			const firstName = document.getElementById('firstName').value.trim();
			const lastName = document.getElementById('lastName').value.trim();
			const email = document.getElementById('email').value.trim();
			const countryCode = document.getElementById('countryCode').value.trim();
			const mobile = document.getElementById('mobile').value.trim();
			const password = document.getElementById('password').value.trim();
			const confirmPassword = document.getElementById('confirmPassword').value.trim();
			const captchaText = document.getElementById('captchaText').textContent.trim();
			const captchaInput = document.getElementById('captchaInput').value.trim();
})
.then(res => res.json())
.then(data => {
  if (data.message === 'User registered successfully!') {
    window.location.href = 'success.html';
  } else {
    alert('Error: ' + data.message);
  }
})
.catch(err => {
  alert('Server error: ' + err.message);
});


			// Reset error messages
			document.getElementById('passwordError').style.display = 'none';
			document.getElementById('captchaError').style.display = 'none';
			document.getElementById('mobileError').style.display = 'none';

			// Validate required fields
			if (!role || !firstName || !lastName || !email || !countryCode || !mobile || !password || !confirmPassword || !captchaInput) {
				alert('Please fill in all required fields.');
				return;
			}

			// Validate mobile
			const mobilePattern = /^[0-9]{10,15}$/;
			if (!mobilePattern.test(mobile)) {
				document.getElementById('mobileError').style.display = 'block';
				return;
			}

			// Validate password match
			if (password !== confirmPassword) {
				document.getElementById('passwordError').style.display = 'block';
				return;
			}

			// Validate captcha
			if (captchaInput.toUpperCase() !== captchaText.toUpperCase()) {
				document.getElementById('captchaError').style.display = 'block';
				generateCaptcha();
		
				return;
			}
  function generateCaptcha() {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let captcha = '';
    for (let i = 0; i < 5; i++) {
      captcha += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    document.getElementById('captchaText').textContent = captcha;
  }

  window.onload = generateCaptcha; // Initialize captcha on page load

			// All validations passed â†’ redirect to success
			window.location.href = 'success.html';
		}

		// Initialize captcha on page load
		window.onload = generateCaptcha;
	</script>
</body>
</html>
