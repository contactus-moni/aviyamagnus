<script>
// Simple in-memory storage (localStorage-backed)
const stateKey = 'tutor_demo_state_v1_student';
let appState = JSON.parse(localStorage.getItem(stateKey) || '{}');
const ROLE = 'student';
const ROLE_LABEL = 'Student';

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById('signedRole').innerText = ROLE_LABEL;
  document.getElementById('pageSub').innerText = 'Quick snapshot for ' + ROLE_LABEL;

  initDemo();
  renderCourses();
  renderMeetings();
  renderAnnouncements();
  renderInbox();
  renderBilling();
  renderCerts();
  renderConvos();

  document.getElementById('fullname').value = appState.profile?.name || '';
  document.getElementById('email').value = appState.profile?.email || '';
  document.getElementById('bio').value = appState.profile?.bio || '';
  document.getElementById('profileShort').innerText = appState.profile?.bio || 'No bio set';

  setRole(ROLE);
  openTab('overview');
  document.getElementById('newMeetingBtn').addEventListener('click', () => openTab('meetings'));
});

// -------------------- STATE --------------------
function saveState(){ localStorage.setItem(stateKey, JSON.stringify(appState)); }

function initDemo(){
  if(!appState.init){
    appState.profile = {name: 'Demo Student', email: 'student@example.com', bio: 'Student account demo'};
    appState.courses = [
      {title:'Mathematics - Basics',category:'Math',progress:'40%'},
      {title:'English Conversation',category:'Language',progress:'80%'}
    ];
    appState.meetings = [];
    appState.docs = [];
    appState.notes = [];
    appState.announcements = [{title:'Welcome',body:'Platform live demo',role:''}];
    appState.chats = {};
    appState.payments = [];
    appState.certs = [];
    appState.init = true;
    saveState();
  }
}

// -------------------- NAVIGATION --------------------
document.querySelectorAll('.nav a').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    openTab(a.getAttribute('data-tab'));
  });
});

function openTab(tab) {
  document.querySelectorAll('.nav a').forEach(a =>
    a.classList.toggle('active', a.getAttribute('data-tab')===tab)
  );
  document.querySelectorAll('.tab').forEach(t => t.classList.add('hidden'));
  const el = document.getElementById(tab + 'Tab');
  if(el) el.classList.remove('hidden');
  document.getElementById('pageTitle').innerText =
    (tab.charAt(0).toUpperCase()+tab.slice(1)).replace(/_/g,' ');
}

// -------------------- ROLES --------------------
function setRole(r){
  const roles = {
    student:['overview','profile','courses','details','documents','meetings','messages','payments','certs','chat','settings'],
    parent:['overview','profile','courses','details','documents','meetings','messages','certs','chat','settings'],
    tutor:['overview','profile','courses','details','documents','meetings','messages','payments','certs','chat','settings']
  };
  const allowed = roles[r] || [];
  document.querySelectorAll('#menu a').forEach(a=>{
    a.style.display = allowed.includes(a.getAttribute('data-tab')) ? 'flex' : 'none';
  });
  document.getElementById('signedRole').innerText = r.charAt(0).toUpperCase()+r.slice(1);
}

// -------------------- PROFILE --------------------
function saveProfile(){
  appState.profile = {
    name:document.getElementById('fullname').value,
    email:document.getElementById('email').value,
    bio:document.getElementById('bio').value
  };
  saveState();
  alert('Profile saved');
  document.getElementById('profileShort').innerText = appState.profile.bio || '';
}
function resetProfile(){
  document.getElementById('fullname').value='
